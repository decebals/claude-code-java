name: Skill Review

on:
  pull_request:
    types: [opened, synchronize]
    paths:
      - '.claude/skills/**'

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}

          claude_args: |
            --model claude-haiku-4-5-20251001
            --allowedTools "Read,Bash(gh pr diff:*),Bash(gh pr view:*),Bash(gh pr comment:*)"

          prompt: |
            REPO: ${{ github.repository }}
            PR NUMBER: ${{ github.event.pull_request.number }}

            Review ONLY the skill files changed in this PR.

            STEP 1: Run `gh pr diff ${{ github.event.pull_request.number }}` to see exactly what changed.
            STEP 2: Read docs/SKILL_GUIDELINES.md to understand validation criteria.
            STEP 3: Read .claude/skills/README.md to check for overlap with existing skills.
            STEP 4: Validate ONLY the changed files against these criteria:

            ## Structure
            - SKILL.md has frontmatter with `name` and `description`
            - README.md exists with human documentation
            - Follows folder convention: `.claude/skills/<skill-name>/`

            ## No Overlap
            - Does not significantly overlap with existing skills
            - If partial overlap, distinction is clear (different level or type)

            ## Quality
            - Not anemic - has substantive content
            - Actionable checklists (not vague advice)
            - Java-specific examples
            - Checklist has <15 items

            ## Output
            Post a single PR comment using `gh pr comment` with:
            1. **Verdict**: APPROVE / REQUEST_CHANGES / NEEDS_DISCUSSION
            2. **Changed Files**: List what was reviewed
            3. **Issues Found**: What needs to change (if any)
            4. **Suggestions**: Optional improvements

            DO NOT explore or review files that were not changed in this PR.
